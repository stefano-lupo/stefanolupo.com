<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Stefano Lupo Tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Stefano Lupo Tech">
<meta property="og:url" content="http://stefanolupo.tech/blog/index.html">
<meta property="og:site_name" content="Stefano Lupo Tech">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stefano Lupo Tech">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Stefano Lupo Tech</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">Programming, tech and other interesting things.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="http://stefanolupo.tech">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://stefanolupo.tech/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-GameOfLife" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/10/17/GameOfLife/" class="article-date">
  <time datetime="2017-10-17T17:27:30.000Z" itemprop="datePublished">17-10-2017</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/10/17/GameOfLife/">John Conway&#39;s Game of Life in Processing</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
<br><br>
<div style="position:relative; top:0; left:0">
    <a id="forkMe" href="https://github.com/stefano-lupo/Game-Of-Life" target="_blank" rel="external">
    <img style="position: absolute; left:0" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png">
    </a>
    <img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/game-of-life/GameOfLife.gif">
</div>


<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        var forkMe = $('#forkMe')
        var crap = $('#forkMe > .fancybox');
        var good = crap.find('img');
        console.log(good);
        forkMe.append(good);
        crap.remove();
    })
   
</script>

<h3 id="Checkout-the-live-demo-on-my-Home-Page"><a href="#Checkout-the-live-demo-on-my-Home-Page" class="headerlink" title="Checkout the live demo on my Home Page!"></a>Checkout the live demo on my <a href="http://www.stefanolupo.tech#game-of-life" target="_blank" rel="external">Home Page!</a></h3><p>I was sitting in a lecture the other day when the lecturers screen saver appeared on the projector. It immediately drew all of our attention as it was a live simulation of <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life" target="_blank" rel="external">John Conway’s Game of Life</a>. I had read and watched videos about this topic before and it is quite an interesting simulation. It acts as a model for population evolves over time and given the right inputs (or not!) it can produce some fascinating results for such a simple concept. I first heard about it from the same place I hear most of the interesting facts about the world, from Mr Michael Stevens aka <a href="https://www.youtube.com/user/Vsauce" target="_blank" rel="external">Vsauce</a>. If you haven’t heard of Vsauce you should definitely check out his YouTube channel. He makes extremely interesting videos on a huge variety of topics ranging from science and math to philosophy and psychology and his content is pretty widely accepted as some of the best on YouTube in that space. </p>
<p>Here is a quick snippet from the video where he mentions it (~90 seconds and it <em>should</em> start from the right point!)</p>
<div style="float: none;
    clear: both;
    width: 100%;
    position: relative;
    padding-bottom: 56.25%;
    padding-top: 25px;
    height: 0;"><br>    <iframe style="position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;" src="https://www.youtube.com/embed/aNgE_hf41NY?start=123" frameborder="0" allowfullscreen><br>    </iframe><br></div>

<p>So just to reiterate what Michael said (or for those who didn’t feel like watching), the simulation contains a grid of cells which are either alive (lit up) or dead (dark) at any point in time. The interesting part comes from the rules which are applied to this grid of cells which govern how the cells survive, are killed and are reborn. The most common ruleset is the following:</p>
<blockquote>
<ol>
<li>Any live cell with fewer than two live neighbours dies, as if caused by underpopulation.</li>
<li>Any live cell with more than three live neighbours dies, as if by overpopulation.</li>
<li>Any live cell with two or three live neighbours lives on to the next generation.</li>
<li>Any dead cell with exactly three live neighbours becomes a live cell, as if by reproduction.</li>
</ol>
</blockquote>
<p>With those four simple rules, some really interesting patterns and phenomena occur such as oscilators and spaceships which can traverse the grid! This article is just to show a simple implementation of The Game of Life in Processing that I wrote on a <del>hungover</del> lazy Sunday afternoon and won’t be exploring any of the outcomes in any great detail, but you can find a bunch more info from people who know a whole lot more about it than I do <a href="http://web.stanford.edu/~cdebs/GameOfLife/" target="_blank" rel="external">right here!</a></p>
<h1 id="The-Processing-Code"><a href="#The-Processing-Code" class="headerlink" title="The Processing Code"></a>The Processing Code</h1><p>The first thing I did was decide on the data structure I would use to represent the grid. The name pretty much gives the game away as a grid is basically a synonym for a matrix or 2D array. Next I declared some constans and global variables which would be useful later on. The only one of note here for now is <code>SQUARE_SIZE</code> which will be the number of pixels each cell will be, the rest are self-explanatory or will be explained later (you decide!).</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="built_in">int</span> SQUARE_SIZE = <span class="number">10</span>;</div><div class="line"><span class="keyword">final</span> <span class="built_in">float</span> GRID_SEED_THRESHOLD = <span class="number">0.8</span>;</div><div class="line"><span class="keyword">final</span> <span class="built_in">boolean</span> DRAW_UI_INFO = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="built_in">int</span> numRows, numCols;</div><div class="line">Cell[][] grid;</div><div class="line"><span class="built_in">boolean</span> settingUp = <span class="keyword">true</span>;</div><div class="line"><span class="built_in">int</span> generation = <span class="number">0</span>;</div><div class="line"><span class="built_in">int</span> numberAlive = <span class="number">0</span>;</div></pre></td></tr></table></figure>
<p>Next the good old <code>void setup()</code>. Here we define the size of our canvas, do some initialization and figure out the number of rows and columns of cells we can have. I was lazy and purposely set my <code>SQUARE_SIZE = 10</code> as I knew the size of my canvas would be a multiple of 10 meaning I wouldn’t have any remainder pixels.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> <span class="title">setup</span>() &#123;</div><div class="line">    <span class="built_in">size</span>(<span class="number">900</span>, <span class="number">600</span>);</div><div class="line">    numRows = <span class="built_in">width</span>/SQUARE_SIZE;</div><div class="line">    numCols = <span class="built_in">height</span>/SQUARE_SIZE;</div><div class="line">    grid = initGrid();</div><div class="line">    generateRandomGrid();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>initGrid()</code> function just creates instances of a <code>Cell</code> class (which will be created later) and slots them into a 2D array to act as our <code>grid</code>. </p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Cell[][] initGrid() &#123;</div><div class="line">    Cell[][] grid = <span class="keyword">new</span> Cell[numRows][numCols];</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;numRows; i++ ) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j=<span class="number">0</span>; j&lt;numCols; j++) &#123;</div><div class="line">            grid[i][j] = <span class="keyword">new</span> Cell();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> grid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The other function here is <code>generateRandomGrid()</code>. This just iterates over our global <code>grid</code> and randomly populates some cells with living cells. This is handy for just creating a random grid to run in order to observe the simulation.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> generateRandomGrid() &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;numRows; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j=<span class="number">0</span>; j&lt;numCols; j++) &#123;</div><div class="line">            <span class="built_in">float</span> r = <span class="built_in">random</span>(<span class="number">1</span>);</div><div class="line">            <span class="keyword">if</span> (r &gt; GRID_SEED_THRESHOLD) &#123;</div><div class="line">                grid[i][j].alive = <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                grid[i][j].alive = <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Next up is the other good old - <code>void draw()</code>. This is split in two by an if statement which tests the <code>settingUp</code> boolean we defined earlier. In setup mode, you can bring cells to life by left clicking and kill off cells by right clicking by making calls on the <code>Cell</code> objects themselves (these will be shown later). This requires a method to convert the mouse click coordinates into row and column indices into the <code>grid</code> and this is done using the <code>getIndex(mouseX, mouseY)</code> function. Finally in setup mode, we check for some key strokes <code>&#39;s&#39;</code> and <code>&#39;g&#39;</code> and respond to them by starting the simulation and regenerating a new random board respectively. </p>
<p>The other half (in running mode), simply applys Conway’s rules to the current board by calling <code>applyRules()</code> and checks if the <code>&#39;r&#39;</code> key has been preset, which initiates a reset of the board through <code>reset()</code>.</p>
<p>Finally for both <code>settingUp</code> and <code>!settingUp</code> (simulating), we make a call to <code>drawGrid()</code> which simply draws grid full of living cells.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> <span class="title">draw</span>() &#123;</div><div class="line">    <span class="keyword">if</span> (settingUp) &#123;</div><div class="line">        <span class="built_in">frameRate</span>(<span class="number">30</span>);</div><div class="line">        <span class="built_in">int</span>[] coords = getIndex(<span class="built_in">mouseX</span>, <span class="built_in">mouseY</span>);</div><div class="line">        <span class="built_in">int</span> i = coords[<span class="number">0</span>];</div><div class="line">        <span class="built_in">int</span> j = coords[<span class="number">1</span>];</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">mousePressed</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (mouseButton == LEFT) &#123;</div><div class="line">                grid[i][j].create();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                grid[i][j].kill();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">keyPressed</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="built_in">key</span> == <span class="string">'s'</span>) &#123;</div><div class="line">                settingUp = <span class="keyword">false</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">key</span> ==<span class="string">'g'</span>) &#123;</div><div class="line">                generateRandomGrid();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">frameRate</span>(<span class="number">15</span>);</div><div class="line">        applyRules();</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">keyPressed</span> &amp;&amp; <span class="built_in">key</span> == <span class="string">'r'</span>) &#123;</div><div class="line">            reset();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    drawGrid();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You may have have noticed the calls to <code>frameRate(30)</code> and <code>frameRate(15)</code>. These (obviously) adjust the frame rate and are are used to slow the simulation down a bit so that we can better see whats going on with how the cells are interacting.</p>
<p>The bodies of the methods mentioned above are given below.</p>
<h3 id="getIndex-mouseX-mouseY"><a href="#getIndex-mouseX-mouseY" class="headerlink" title="getIndex(mouseX, mouseY)"></a>getIndex(mouseX, mouseY)</h3><p>This returns valid indices into the <code>grid</code>. This actually caused some problems as clicking and dragging the mouse off the canvas actually caused processing to pass me coordinates that were out of range of the canvas (ie coordinates &lt; 0 or coordinates &gt; canvas height etc). A simple bit of logic can be used to combat this however. Taking <code>x</code> as an example coordinate we can:</p>
<ol>
<li><code>int largerThanZero = max(x, 0)</code> - This ensures that <code>x</code> is non-negative</li>
<li><code>min(largerThanZero, width-1)</code> - This ensures that <code>x</code> is not larger than the size of the canvas.</li>
</ol>
<p>Now that we have <em>cleaned</em> x and y coordinates, we can use integer division to get the nearest cell in our grid and return those as the indices.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">int</span>[] getIndex(<span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</div><div class="line">    <span class="built_in">int</span>[] cleanedCoords = &#123;<span class="built_in">min</span>(<span class="built_in">max</span>(x, <span class="number">0</span>), <span class="built_in">width</span><span class="number">-1</span>), <span class="built_in">min</span>(<span class="built_in">max</span>(y, <span class="number">0</span>), <span class="built_in">height</span><span class="number">-1</span>) - <span class="number">1</span>&#125;;</div><div class="line">    cleanedCoords[<span class="number">0</span>] = cleanedCoords[<span class="number">0</span>] / SQUARE_SIZE;</div><div class="line">    cleanedCoords[<span class="number">1</span>] = cleanedCoords[<span class="number">1</span>] / SQUARE_SIZE;</div><div class="line">    <span class="keyword">return</span> cleanedCoords;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="applyRules"><a href="#applyRules" class="headerlink" title="applyRules()"></a>applyRules()</h3><p>This is where the <em>interesting</em> logic of the simulation comes in. The rules were given above but here is a quick refresher in some weird pseudo-peseudoish-code: </p>
<blockquote>
<ol>
<li>(&lt;2 neighbours) =  DIE</li>
<li>(&gt;3 neighbours) = DIE.</li>
<li>(2 &lt;= neighbours &lt;= 3) &amp;&amp; currentlyAlive = LIVE</li>
<li>(neighbours == 3) &amp;&amp; currentlyDead = REBIRTH</li>
</ol>
</blockquote>
<p>A key concept here is that rules apply to all of the cells in the grid for a given generation <strong>simultaenously</strong>. That is, you can’t update the board as you iterate over it checking the cells of the current generation. We need a snapshot of the board in its current state to compare each cell against. Or more simply, we create a new board on each generation, fill <strong>that</strong> board based on the previous generation rather than updating the old board.</p>
<p>This function then is rather simple. We create our new grid using <code>initGrid()</code> and iterate over the board. For each cell, we check how many neighbours it has using the (yet to be defined) <code>getNumberOfNeigbours(rowIndex, columnIndex)</code> function, apply Conway’s rules to that cell and figure out if it should be alive or dead in the next grid and update our <strong>new</strong> grid accordingly! Again we use some <code>Cell</code> instance methods <code>kill(), create()</code>(bring back to life) and <code>age()</code> that cell. Ageing has no effect on the simulation but is just used to set the colour of the cell in order to get a visual representation of how long a given cell has been around for.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> applyRules() &#123;</div><div class="line">    <span class="comment">// Create our NEW grid for the next generation</span></div><div class="line">    Cell[][] nextGrid = initGrid();</div><div class="line"></div><div class="line">    <span class="comment">// This is just used to show the user how many cells are currently living</span></div><div class="line">    numberAlive = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;numRows; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j=<span class="number">0</span>; j&lt;numCols; j++) &#123;</div><div class="line">            <span class="built_in">int</span> numNeighbours = getNumberOfNeighbours(i, j);</div><div class="line">            <span class="keyword">if</span> (numNeighbours &lt; <span class="number">2</span> || numNeighbours &gt; <span class="number">3</span>) &#123;</div><div class="line">                nextGrid[i][j].kill();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// Two or three neighbours</span></div><div class="line">                <span class="keyword">if</span> (!grid[i][j].alive &amp;&amp; numNeighbours == <span class="number">3</span>) &#123;</div><div class="line">                    nextGrid[i][j].create();</div><div class="line">                    numberAlive ++;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// Alive with two or 3 neighbours</span></div><div class="line">                    Cell oldCell = grid[i][j];</div><div class="line">                    oldCell.age();</div><div class="line">                    nextGrid[i][j] = oldCell;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    grid = nextGrid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And of course the <code>getNumberOfNeighbours(row, column)</code> function will return the number of neighbours the cell at that position has. For the general case each cell has 8 possible neighbours - 3 above it, 2 on either side of it and 3 below it. However (literal) edge cases exist for cells that are on the border.</p>
<p>To handle these we can define the max and min allowed values for the row an column, and iterate from <code>rowMin</code> to <code>rowMax</code> and inside that iterate from <code>colMin</code> to <code>colMax</code>. In the general case where <code>r</code> and <code>c</code> are the cell in questions row and column:</p>
<ul>
<li><code>rowMin</code> = <code>r-1</code></li>
<li><code>rowMax</code> = <code>r+1</code></li>
<li><code>colMin</code> = <code>c-1</code></li>
<li><code>colMax</code> = <code>c+1</code></li>
</ul>
<p>However we apply the same trick of <strong>maximizing</strong> any potentially <strong>negative</strong> rows/cols with <strong>0</strong> and <strong>minimizing</strong> any rows/cols that can be <strong>greater than the <code>grid</code> dimensions</strong> with the <code>numRows</code> and <code>numCols</code> respectively. </p>
<p>Finally we can iterate over the 9 adjacent cells, and perform one last check that we aren’t at the <code>row</code> and <code>column</code> that corresponds to ourselves (as we don’t want to count ourselves!).<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">int</span> getNumberOfNeighbours(<span class="built_in">int</span> r, <span class="built_in">int</span> c) &#123;</div><div class="line">    <span class="built_in">int</span> numberOfNeighbours = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="built_in">int</span> rowMin = <span class="built_in">max</span>(r<span class="number">-1</span>, <span class="number">0</span>);</div><div class="line">    <span class="built_in">int</span> rowMax = <span class="built_in">min</span>(r+<span class="number">1</span>, numRows<span class="number">-1</span>);</div><div class="line"></div><div class="line">    <span class="built_in">int</span> colMin = <span class="built_in">max</span>(c<span class="number">-1</span>, <span class="number">0</span>);</div><div class="line">    <span class="built_in">int</span> colMax = <span class="built_in">min</span>(c+<span class="number">1</span>, numCols<span class="number">-1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> row = rowMin; row &lt;= rowMax; row++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> col = colMin; col &lt;= colMax; col++) &#123;</div><div class="line">            <span class="keyword">if</span> (row != r || col != c) &#123;</div><div class="line">                <span class="keyword">if</span> (grid[row][col].alive) &#123;</div><div class="line">                    numberOfNeighbours ++;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> numberOfNeighbours;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="drawGrid"><a href="#drawGrid" class="headerlink" title="drawGrid()"></a>drawGrid()</h3><p>Finally after all that work it’s time to draw something to the screen. This part is easy, just iterate over the grid and call <code>cell.drawCell(row, column)</code> on each cell in the grid and they will handle drawing themsevles. The only other things in this method are clearing the prevously drawn cells by redrawing a black backgroun with <code>background(0)</code> and (conditionally) drawing an overlay containing some info about the simulation (how many are currently alive / generation number etc). </p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> drawGrid() &#123;</div><div class="line">    <span class="built_in">background</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;numRows; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j=<span class="number">0</span>; j&lt;numCols; j++) &#123;</div><div class="line">            grid[i][j].drawCell(i,j);   </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(DRAW_UI_INFO) &#123;</div><div class="line">        drawUI();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="reset"><a href="#reset" class="headerlink" title="reset()"></a>reset()</h3><p>The last function we need is one to reset the board and it is pretty self explanatory - it puts us back in setup mode, recreates a fresh grid and reinitializes the generation and number of alive cells to 0. In Java, we can rest assured that garbage collection will handle freeing up our now out of scope old grid. </p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> reset() &#123;</div><div class="line">    settingUp = <span class="keyword">true</span>;</div><div class="line">    grid = initGrid();</div><div class="line">    generation = <span class="number">0</span>;</div><div class="line">    numberAlive = <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="The-Cell-Class"><a href="#The-Cell-Class" class="headerlink" title="The Cell Class"></a>The Cell Class</h2><p>Almost there, just a super basic class to represent our <code>Cell</code>s. The only interesting thing about this Cell class is the concept of “colour-aging”. As discussed, I thought it would be nice to have some visual feedback on how long a certain cell had been around for. So the cells start out with a <code>blue</code> value of 255 (fully blue) and a <code>red</code> value of 0 (no red). On each tick a cell survives, we remove <code>COLOUR_STEP</code> from it’s <code>blue</code> value and add <code>COLOUR_STEP</code> to it’s red value. This allows the colour of the cells to change over time based on how many generations they have been alive for.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    <span class="built_in">boolean</span> alive;</div><div class="line">    <span class="built_in">int</span> <span class="built_in">red</span>;</div><div class="line">    <span class="built_in">int</span> <span class="built_in">blue</span>;</div><div class="line"></div><div class="line">    <span class="comment">// This controls how fast the cells "colour-age"</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="built_in">int</span> COLOUR_STEP = <span class="number">2</span>;</div><div class="line"></div><div class="line">    Cell() &#123;</div><div class="line">        alive = <span class="keyword">false</span>;</div><div class="line">        <span class="built_in">red</span> = <span class="number">0</span>;</div><div class="line">        <span class="built_in">blue</span> = <span class="number">255</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// Draws the cell with the appropriate "colour-age" at the appropriate position</span></div><div class="line">    <span class="keyword">void</span> drawCell(<span class="built_in">int</span> row, <span class="built_in">int</span> col) &#123;</div><div class="line">        <span class="keyword">if</span> (alive) &#123;</div><div class="line">            <span class="built_in">int</span> x = row*SQUARE_SIZE;</div><div class="line">            <span class="built_in">int</span> y = col*SQUARE_SIZE;</div><div class="line">            <span class="built_in">fill</span>(<span class="built_in">red</span>, <span class="number">0</span>, <span class="built_in">blue</span>);</div><div class="line">            <span class="built_in">rect</span>(x, y, SQUARE_SIZE, SQUARE_SIZE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// Kill off the cell and set its "colour-age" back to fully blue</span></div><div class="line">    <span class="keyword">void</span> kill() &#123;</div><div class="line">        <span class="keyword">this</span>.alive = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">this</span>.<span class="built_in">red</span> = <span class="number">0</span>;</div><div class="line">        <span class="keyword">this</span>.<span class="built_in">blue</span> = <span class="number">255</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Bring the cell back to life</span></div><div class="line">    <span class="keyword">void</span> create() &#123;</div><div class="line">        <span class="keyword">this</span>.alive = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Age the cell from blue to red for each tick they survive.</span></div><div class="line">    <span class="keyword">void</span> age() &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">blue</span> &gt; <span class="number">20</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.<span class="built_in">blue</span> -= COLOUR_STEP;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="built_in">red</span> &lt; <span class="number">255</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.<span class="built_in">red</span> += COLOUR_STEP;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Give-it-a-go"><a href="#Give-it-a-go" class="headerlink" title="Give it a go!"></a>Give it a go!</h1><p>That’s it! Now we have our own Conway’s Game of Life. I’m sure this is nothing new and that there is a tonne of them already written in Processing, but I just decided to write my own for fun! Only after I built it in Processing did I realise I could use processing.js to run it in a browser!</p>
<p>Feel free to play around with the simulator on <a href="http://stefanolupo.tech#game-of-life">my homepage</a>.<br>Thanks for reading! </p>

<script type="text/javascript">
      var processingInstance;

      function start() {
        processingInstance = Processing.getInstanceById('game-of-life-canvas');
        processingInstance.startButtonPressed();
      }

      function stop() {
        processingInstance = Processing.getInstanceById('game-of-life-canvas');
        processingInstance.stopButtonPressed();
      }

      function generate() {
        processingInstance = Processing.getInstanceById('game-of-life-canvas');
        processingInstance.generateButtonPressed();
      }

    </script>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://stefanolupo.tech/blog/2017/10/17/GameOfLife/" data-id="cj967jv4s0000blqjlm08fpks" class="article-share-link">Share</a>
      
        <a href="http://stefanolupo.tech/blog/2017/10/17/GameOfLife/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Processing-Java-Processing-js-John-Conway-s-Game-Of-Life/">Processing Java Processing.js John Conway's Game Of Life</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="page-Airport-Web-Sockets" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/09/19/Airport-Web-Sockets/" class="article-date">
  <time datetime="2017-09-19T14:37:15.000Z" itemprop="datePublished">19-09-2017</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Web-Programming/">Web Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/09/19/Airport-Web-Sockets/">WebSocket Chat Room</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/websocket-chat-server/chatroom.png" alt="Websocket Chat Room"><br>So I was just about to board my flight to Amsterdam when we were informed that the flight was to be delayed by three hours (guess what airline I was flying with..). I started thinking of things to do to kill the time, but had decided not to bring my laptop with me. Fortunately however I have my router port forwarded so I have ssh access to my Raspberry Pi (which I leave on 24/7 since it uses a whole 1.2 Watts) from anywhere I have an internet connection. So I pulled out my phone and fired up JuiceSSH and started thinking what I could do..</p>
<h2 id="What-Are-WebSockets"><a href="#What-Are-WebSockets" class="headerlink" title="What Are WebSockets?"></a>What Are WebSockets?</h2><p>I had done some socket programming before (mainly writing a simple HTTP/HTTPS Proxy Server in Java  - <a href="https://github.com/stefano-lupo/Java-Proxy-Server" target="_blank" rel="external">GitHub Repo</a>) but I had heard the buzz word <em>WebSockets</em> being thrown around a lot lately so I decided to check it out. I had a rough idea of what to expect but a quick google gave me a nice succint description: </p>
<blockquote>
<p>“WebSockets represent a long awaited evolution in client/server web technology. They allow a long-held single TCP socket connection to be established between the client and server which allows for bi-directional, full duplex, messages to be instantly distributed with little overhead resulting in a very low latency connection.” - <em>from <a href="https://pusher.com/websockets" target="_blank" rel="external">pusher.com</a></em></p>
</blockquote>
<p>The first things that come to mind when reading that description are real-time applications such as video games and chat. Since I only had two hours (and was developing over SSH on my phone), I decided on the latter. Another quick google search provided a <a href="http://codular.com/node-web-sockets" target="_blank" rel="external">great blog post</a> on setting up a simple chat server with WebSockets.</p>
<h2 id="Getting-the-Required-Tools"><a href="#Getting-the-Required-Tools" class="headerlink" title="Getting the Required Tools"></a>Getting the Required Tools</h2><p>The first thing to do was to obtain a WebSocket library for node. There are a bunch of WebSocket implementations and im sure most are great, but the I went for was <em>websocket-node</em>. The first thing to do was to make a directory to hold my project. As I knew there would be server side and client side code, I made two seperate directories - <em>public</em> for client side code and <em>server</em> for server side code.</p>
<p>A quick note here - as we need to serve up the client side code (through a browser in my case), we need some extra functionality to do this for us. As I am a web developer I already had the LAMP stack set up on my machines at home (<a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-ubuntu-16-04" target="_blank" rel="external">this is a great article</a> on how to set this up if you haven’t already). The LAMP stack is an extremely common and easy way to serve up static websites and is most likely what was used if you have ever paid for web hosting. Another great option if you would like to stick with Node is Express. I probably would have went with this had I not already had a way to serve web pages set up. </p>
<p>I set up a new virtual host for my WebSocket chat server (<a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-apache-virtual-hosts-on-ubuntu-14-04-lts" target="_blank" rel="external">see here</a>) and proceeded to create the directories to hold my chat server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Note you may need sudo here depending on how you have set up your permissions</span></div><div class="line">$ mkdir /var/www/websockets/public /var/www/websockets/server -p</div></pre></td></tr></table></figure>
<p>The <em>-p</em> flag for mkdir is a handy one which will create any directories that do not exist along the way, saving you from typing multiple mkdir commands. </p>
<p>Next I created a package.json file in my server directory (as this will be written in node, but the client side code will not).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> /var/www/websockets/server</div><div class="line">$ npm init</div></pre></td></tr></table></figure>
<p>Follow along in the initialization process to create your <em>package.json</em> file (although what you actually type has little importance). Finally install <em>websocket-node</em> using the following: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Again, either use sudo, or chown the websockets directory</span></div><div class="line">$ npm install websocket --save</div></pre></td></tr></table></figure>
<h1 id="Creating-the-WebSocket-Chat-Server"><a href="#Creating-the-WebSocket-Chat-Server" class="headerlink" title="Creating the WebSocket Chat Server"></a>Creating the WebSocket Chat Server</h1><h2 id="Server-Side-Code"><a href="#Server-Side-Code" class="headerlink" title="Server Side Code"></a>Server Side Code</h2><p>Finally it was time to write some code. I decided to work on the server side code first. The first step is to set up a standard Node HTTP server.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;&#125;);</div></pre></td></tr></table></figure></p>
<p>Next we need to specify a free port on which the server can listen. I picked 3000 as I had already portforwarded that port to my Raspberry Pi on my router. Portforwarding allows your router to forward incoming packets at the specified port, to a specified machine on your local network. It looks something like this:</p>
<p><strong><em>http://&lt;Router’s IP&gt;:3000    —&gt;    Router    —&gt;    Server on Raspberry Pi Listening on port 3000</em></strong></p>
<p>Since I had port forwarded port 3000 to point to my Raspberry Pi, the router then forwards those packets onto my Raspberry Pi allowing my server to be connected to from outside of my local network.</p>
<p>So telling our HTTP server to listen on port 3000:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Server is listening on port 3000'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Next we can create a WebSocket Server and connect it up to our HTTP server by passing the HTTP server to the constructor. This <code>WebSocket</code> is what gives us our long held client-server connection, as opposed to standard HTTP which requires a fresh HTTP request everytime we wish to update.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'websocket'</span>).server;</div><div class="line">wsServer = <span class="keyword">new</span> WebSocketServer(&#123; <span class="attr">httpServer</span>: server &#125;);</div></pre></td></tr></table></figure>
<p>Next we need some way of keeping track of our clients and the messages that have been sent. As I was just doing this for fun I didn’t implement anything fancy for storing the messages (no not even file IO - but I was doing this from my phone after all…). I ended up just storing the messages in an array which obviously isn’t a good idea, but it works in the short term.</p>
<p>So we need three variables, one to use as clients IDs, a Map to hold our clients which can be indexed by the ID and an array of sent messages.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> id = <span class="number">0</span>;</div><div class="line"><span class="keyword">var</span> clients = <span class="keyword">new</span> <span class="built_in">Map</span>();</div><div class="line"><span class="keyword">var</span> messages = [];</div></pre></td></tr></table></figure>
<p>Next we define the callback to executed when a client attempts to connect to the server. Upon receiving a request, we have the option to accept or reject the client. All are welcome on my chat server so I just accepted any incoming connections. I assign the new client the next ID and increment the ID so it’s ready for the next client, add the client to our clients Map and log out a small message to the terminal so we can see when clients have joined. Finally we will send all the old messages to the newly connected client. Note that the sendUTF method obviously only works with strings, but since were using JSON, a simple <code>JSON.stringify()</code> takes care of that and the data can be recovered using <code>JSON.parse()</code> on the other side.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">wsServer.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">request</span>) </span>&#123;</div><div class="line">    <span class="comment">// Envoked when client connects, send them all previous messages</span></div><div class="line">    <span class="keyword">var</span> connection = request.accept(<span class="string">'echo-protocol'</span>, request.origin);</div><div class="line">    connection.id = id++;</div><div class="line">    clients.set(id, connection);</div><div class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Connection accepted ['</span> + connection.id + <span class="string">']'</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Send old messages to client</span></div><div class="line">    connection.sendUTF(<span class="built_in">JSON</span>.stringify(messages));</div><div class="line"></div><div class="line">    <span class="comment">// More code to go here soon..</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Finally we need to define a couple more callbacks for when a client sends a message (or rather, when the server receives a message) and when the client disconnects. WebSockets make this really simple with the <code>on(&#39;message&#39;, callback)</code> and <code>on(&#39;close&#39;, callback)</code> respectively. Upon (the server) receiving a message, we want to save the message and broadcast that message to all connected clients. Ideally, we wouldn’t send this back to client who sent it and just update the sender’s client side messages, but as this was just a quick implementation, I went with the simpler route of just having the message broadcast to and picked up by all clients (including the sender). </p>
<p>Finally when a client disconnects, we free up the resources they were using and remove them from our clients Map so that we don’t try to send any more messages to that connection. This is why we used a Map, so that the client with the appropriate ID can be deleted.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">wsServer.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">request</span>) </span>&#123;</div><div class="line">    <span class="comment">// ....Previous code</span></div><div class="line"></div><div class="line">    <span class="comment">// Envoked when a message is sent</span></div><div class="line">    connection.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> msgString = message.utf8Data;</div><div class="line">        messages.push(msgString);</div><div class="line">        sendToAllClients(msgString);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// Envoked when client disconnects</span></div><div class="line">    connection.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">reasonCode, description</span>) </span>&#123;</div><div class="line">        clients.delete(connection.id);</div><div class="line">        <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Peer '</span> + connection.remoteAddress + <span class="string">' disconnected.'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The last thing to do on the server side code is to define our <code>sendToAllClients(message)</code> function. Since we have a Map containing all of our clients and a function <code>sendUTF(message)</code> to send a message to a client, this is really simple.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Note this is outside of the on request received function body</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendToAllClients</span>(<span class="params">message</span>) </span>&#123;</div><div class="line">    clients.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">client</span>) </span>&#123;</div><div class="line">        client.sendUTF(message);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Client-Side-Code"><a href="#Client-Side-Code" class="headerlink" title="Client Side Code"></a>Client Side Code</h2><p>Now that the server is all set up its time to create the web page for the chat room. I wrote this using basic HTML, CSS, Bootstrap and jQuery. First head back to the root of our project, cd into our public folder and make two files - <em>index.html</em> and <em>script.js</em>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/www/websockets/public</div><div class="line">touch index.html script.js</div></pre></td></tr></table></figure>
<p>I started out with the markup to create the interface. It consists of two <code>&lt;form&gt;</code>s (one for signing up for the chat room and one for sending messages) and a <code>&lt;ul&gt;</code> to which we will programatically add <code>&lt;li&gt;</code>s as we receive messages.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span>The Worlds Worst Chat Room <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Join The Chat Room<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"join"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span> <span class="attr">placeholder</span>=<span class="string">"Enter your name"</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">name</span>=<span class="string">"name"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span> <span class="attr">placeholder</span>=<span class="string">"Avatar URL"</span> <span class="attr">id</span>=<span class="string">"avatar"</span> <span class="attr">name</span>=<span class="string">"avatar"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"join_button"</span> <span class="attr">id</span>=<span class="string">"join_button"</span>&gt;</span>Join<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Chat<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"chat-div"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"chatlog"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  </div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"send"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">"4"</span> <span class="attr">cols</span>=<span class="string">"50"</span> <span class="attr">required</span> <span class="attr">disabled</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">id</span>=<span class="string">"message"</span> <span class="attr">placeholder</span>=<span class="string">"Send a message"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-danger disabled"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">id</span>=<span class="string">"send-button"</span>&gt;</span>Send!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Finally I added some styling, grabbed CDNs for Bootstrap and jQuery and included our script.js file.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span>/&gt;</span><span class="undefined"></span></div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"script.js"</span>&gt;</span><span class="undefined"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">integrity</span>=<span class="string">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">    #chat-div &#123;</span></div><div class="line"><span class="undefined">        border: solid black 1px;</span></div><div class="line"><span class="undefined">        height:350px; </span></div><div class="line"><span class="undefined">        overflow:auto;</span></div><div class="line"><span class="undefined">        -webkit-box-shadow: 5px 5px 34px -10px rgba(0,0,0,0.75);</span></div><div class="line"><span class="undefined">        -moz-box-shadow: 5px 5px 34px -10px rgba(0,0,0,0.75);</span></div><div class="line"><span class="undefined">        box-shadow: 5px 5px 34px -10px rgba(0,0,0,0.75);</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    #chatlog &#123;</span></div><div class="line"><span class="undefined">        list-style-type:none; </span></div><div class="line"><span class="undefined">    </span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    hr &#123;</span></div><div class="line"><span class="undefined">        margin-top: 5px;</span></div><div class="line"><span class="undefined">        margin-bottom: 5px;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    h4 &#123;</span></div><div class="line"><span class="undefined">        display: inline</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    #avatar-pic &#123;</span></div><div class="line"><span class="undefined">        width: 50px;</span></div><div class="line"><span class="undefined">        border-radius: 50%;</span></div><div class="line"><span class="undefined">        border: solid rgba(0,0,0,0.6) 1px;</span></div><div class="line"><span class="undefined">        margin: 5px;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    #date-string &#123;</span></div><div class="line"><span class="undefined">        text-align: right;</span></div><div class="line"><span class="undefined">        float:right;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">    #message-li &#123;</span></div><div class="line"><span class="undefined">        padding:5px 0px 5px 0px</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>The last thing we have to do is to connect up our client side code to our server and set up some logic in jQuery to handle the client joining the chat room and sending messages. Once the client submits the join form, we will save their inputted credentials and connect to the server. This is really easy with WebSockets, simply create a <code>new WebSocket</code> instance that points to our server. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Ensure document is defined (page is fully loaded)</span></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> ws;</div><div class="line">    <span class="keyword">var</span> name, avatar;</div><div class="line"></div><div class="line">    <span class="comment">// Allow the client to join the server </span></div><div class="line">    $(<span class="string">"#join"</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">        event.preventDefault();</div><div class="line"></div><div class="line">        <span class="comment">// Save credentials</span></div><div class="line">        name = $(<span class="string">"#name"</span>).val();</div><div class="line">        avatar = $(<span class="string">"#avatar"</span>).val();</div><div class="line">      </div><div class="line">        <span class="comment">// Connnect to Server</span></div><div class="line">        ws =  <span class="keyword">new</span> WebSocket(<span class="string">'ws://&lt;server&gt;:&lt;port&gt;'</span>, <span class="string">'echo-protocol'</span>);</div><div class="line"></div><div class="line">        <span class="comment">// More code to go here..</span></div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>We need to define a couple of callbacks in order to get the functionality we want. <code>onopen</code> allows us to define a callback function that will be executed when we successfully connect to the server. I wanted to announce when a new client joined the chatroom, so in the body of the <code>onopen</code> callback I created a new message object and sent that off to the server. I also enabled the <code>&lt;textarea&gt;</code> field which is used for inputing the user’s message and the submit <code>&lt;button&gt;</code> which is used for sending the message. Until this point they were both disabled as I didn’t want users attempting to send messages prior to connecting to the server.</p>
<p>We also need an event listener to handle receiving messages from the server. Once messages are received from the server, we want to create <code>&lt;li&gt;</code>s to hold the new messages. For clarity we will define this function later, so the callback just needs to call this function for each new message that is received (or array of messages in the case of the server sending the array of past messages when the client connects).<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"#join"</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// ...Previous code</span></div><div class="line"></div><div class="line">    <span class="comment">// Send "client" joined chatroom messgae  </span></div><div class="line">    ws.onopen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> message = &#123;</div><div class="line">            name: name,</div><div class="line">            avatar: avatar,</div><div class="line">            message: <span class="string">"joined the chatroom."</span>,</div><div class="line">            date: <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">        &#125;</div><div class="line">        ws.send(<span class="built_in">JSON</span>.stringify(message));</div><div class="line"></div><div class="line">        <span class="comment">// Allow client to send messages</span></div><div class="line">        $(<span class="string">"#message"</span>).prop(<span class="string">'disabled'</span>, <span class="literal">false</span>);</div><div class="line">        $(<span class="string">"#send-button"</span>).removeClass(<span class="string">"disabled btn-danger"</span>).addClass(<span class="string">"btn-success"</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// Add Listener for receiving messages</span></div><div class="line">    ws.addEventListener(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> msg = <span class="built_in">JSON</span>.parse(e.data);</div><div class="line"></div><div class="line">        <span class="comment">// Server sends an array of passed messages to client upon joining</span></div><div class="line">        <span class="keyword">if</span>(<span class="built_in">Array</span>.isArray(msg)) &#123;</div><div class="line">            msg.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</div><div class="line">                addMessage(<span class="built_in">JSON</span>.parse(message));   </div><div class="line">            &#125;);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            addMessage(msg);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Scroll to bottom of chat div to keep up with current messages</span></div><div class="line">        $(<span class="string">'#chat-div'</span>).scrollTop($(<span class="string">'#chat-div'</span>)[<span class="number">0</span>].scrollHeight);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Next we need a listener for sending messages to the server. This callback simply creates a message obejct, sends it on to the server and and clears the message <code>&lt;textarea&gt;</code> in preperation for the next message.</p>
<p>Finally we define the <code>addMessage(message)</code> function. We make use of jQuery’s <code>append(markup)</code> method in order to append a list item to the unordered list which holds our messages. Theres some extra bits and pieces in the markup to display the sender’s name, avatar and the timestamp.</p>
<pre><code class="js"><span class="comment">// Add listener for sending messages</span>
$(<span class="string">"#send"</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>{
    event.preventDefault();

    <span class="comment">// Package up the message object</span>
    <span class="keyword">var</span> message = {
        name: name,
        avatar: avatar,
        message: $(<span class="string">"#message"</span>).val(),
        date: <span class="keyword">new</span> <span class="built_in">Date</span>()
    }

    <span class="comment">// Clear the message input field once the message has been sent </span>
    $(<span class="string">"#message"</span>).val(<span class="string">''</span>);

    <span class="comment">// Send the message object (serialized as a string)</span>
    ws.send(<span class="built_in">JSON</span>.stringify(message));
});  

<span class="comment">// Some markup for the messages</span>
<span class="function"><span class="keyword">function</span> <span class="title">addMessage</span>(<span class="params">message</span>) </span>{
    $(<span class="string">"#chatlog"</span>).append(<span class="string">'&lt;li id="message-li"&gt;'</span>
        + <span class="string">'&lt;div&gt;&lt;img id="avatar-pic" src="'</span>
        + <span class="string">"  "</span> + message.avatar + <span class="string">'"&gt;'</span> 
        + <span class="string">"&lt;h4&gt;"</span> + message.name + <span class="string">"&lt;/h4&gt;"</span>
        + <span class="string">'&lt;p id="date-string"&gt;'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>(message.date).toLocaleTimeString() + <span class="string">"&lt;/p&gt;&lt;/div&gt;"</span> 
        + message.message 
        + <span class="string">"&lt;hr&gt;"</span>   
        + <span class="string">"&lt;/li&gt;"</span>
    );
}
</code></pre>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>And with that we’re all set. Run the server code with <code>node server/index.js</code> from the root of our project directory and browse to your IP address (or localhost if you’re developing locally) and give it a go!</p>
<p>The full source code is available <a href="https://github.com/stefano-lupo/websocket-chat-server" target="_blank" rel="external">here on GitHub</a>. Thanks for reading.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://stefanolupo.tech/blog/2017/09/19/Airport-Web-Sockets/" data-id="cj8pvoers000016qj80zyuev9" class="article-share-link">Share</a>
      
        <a href="http://stefanolupo.tech/blog/2017/09/19/Airport-Web-Sockets/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/WebSockets-Node-Javascript-SSH-Raspberry-Pi/">WebSockets Node Javascript SSH Raspberry Pi</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="page-hexagonPatioTable" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/09/02/hexagonPatioTable/" class="article-date">
  <time datetime="2017-09-02T17:56:28.000Z" itemprop="datePublished">02-09-2017</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Woodworking/">Woodworking</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/09/02/hexagonPatioTable/">Octagonal Patio Table</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170610_180608.jpg" alt="The Finished Table"><br>So back at the start of summer just as I was finishing my exams, I was snooping around my house looking for something that was old / damaged that I knew would be annoying my Mum. After about a month straight of studying (and writing way more ARM Assembly than one should ever have to) I really wanted to build something. Also at this point I had spent all my money on tools and hadn’t yet <em>built</em> anything with them (hence me looking for a project that my mum would <del>fund</del> be interested in),  so was feeling a bit dumb at this stage. </p>
<p>I finally looked out the back and realised our patio table was pretty destroyed after sitting out in Irish weather for about 8 years. </p>
<p><img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170902_181553.jpg" alt="Gross Old Patio Table"></p>
<p>So I decided that this would be a fun big project and one that would be quite useful for the summer. My family suggested refinishing it which I quickly rejected due to all that sanding (and besides the wood was starting to rot anyway) and decided to build a new one.</p>
<h1 id="Steve-Ramsey’s-Octagonal-Patio-Table"><a href="#Steve-Ramsey’s-Octagonal-Patio-Table" class="headerlink" title="Steve Ramsey’s Octagonal Patio Table"></a>Steve Ramsey’s Octagonal Patio Table</h1><p>Luckily for me tonnes of people have posted videos about every topic conceivable on YouTube, so I started there. I came accross a <a href="https://www.youtube.com/watch?v=DPIfzyXd9Hg" target="_blank" rel="external">Steve Ramsey video</a> (who by the way is a great You Tuber who makes woodworking accessible for everyone) and decided to go for his cool octagonal patio table design.</p>
<p>The first thing I did was figure out how to make an octagon which is pretty easy: </p>
<blockquote>
<p>360 degrees / 8 sides = 45 degrees / 2 cuts join together = 22.5 degrees</p>
</blockquote>
<p>This means that each segment of the octagon needs a 22.5 degree mitre on both ends, so that when two adjacent segments are joined together the resulting angle is 45 degrees. Im <strong>really</strong> bad at visualizing things (as was confirmed in every aptitude test I’ve ever taken - probably why Im a computer engineer..) so I had to make a little mini test octagon, but I also didnt want to cut 8 pieces to make a test octagon so I cut two pieces. I could then place the two down and trace them with chalk, move one piece to act as the next segment, trace the newly added piece and repeat. This traced me out a nice octagon so I was happy that my angles / mitre setup was correct.</p>
<p>I went ahead and cut 8 pieces (at 90 degreees) to the <strong>long</strong> dimension. Once I knew these were all the same, I could set up my mitre gauge to make a 22.5 degree cut and cut each piece such that the long side wouldn’t be shortened at all, resulting in 8 pieces with the same long side length and same angle - so 8 identical pieces. I laid the 8 pieces out and I had a pretty nice fitting octagon!</p>
<p><img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170528_163314.jpg" alt="The Octagon and &quot; Chalk Test for Idiots&trade; &quot;"></p>
<p>I cut a rabbet on the insde of all 8 pieces to accept the 4x1 pieces that would make up the actual table top, glued and pocket screwed all the 8 pieces together and had a solid octagon!</p>
<p>I then got to work cutting and fitting the 4x1s to span the width of the octagon and make up the table top. Most of these cuts were simple 90 or 45 degree cuts but four of them (one on each of the ends of two of the pieces) were a little messier as part of the cut had to be 90 degrees and the other part 45 degrees. This wasn’t too bad though, I just cut them square at their full length and then snook up (reallllyy slowly) on the 45 degree cut until the piece slotted in. This makes more sense with a picture.</p>
<p> <img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170610_180451.jpg" alt="Partial 45 degree cut"></p>
<h1 id="The-Legs"><a href="#The-Legs" class="headerlink" title="The Legs"></a>The Legs</h1><p> I followed Steve Ramsey’s plans again here and attached the legs together using two cross pieces joined using half laps. I pocket screwed the bottom cross braces into the legs from underneath so they were out of sight. However for the top cross brace, I cut a rabbet onto each of the four ends of the cross so that the octagon could sit on top of the rabbet. This meant the top was now connected to the upper cross piece and I finally connected this assembly to each of the four legs with screws through the front of the legs and capped them with dowels so they wouldn’t be noticable (which you <em>just</em> see at the top of the leg in the following image).</p>
<p> <img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170530_201330.jpg" alt="The (almost) Assembled Table"></p>
<p> And yes I ran out of 4x1 at this point so had to wait till the next day to put in the final pieces.<br> One thing that irritates me about this table is the last pieces of the table top being really skinny - you can see the slot for the last piece of the top on the left in the previous picture.</p>
<h1 id="The-Finished-Table"><a href="#The-Finished-Table" class="headerlink" title="The Finished Table"></a>The Finished Table</h1><p> All that was left to do was to apply a finish. I really liked the ‘whiteness’ (or lack of yellowness) of unfinished pine and have had projects in past look awful due to how yellow the pine went after varnishing. Luckily I found this <a href="http://www.ronseal.co.uk/home/exterior-doors-and-windows/outdoor-varnish/" target="_blank" rel="external">Ronseal Outdoor Varnish</a> that apparently “doesn’t yellow like traditional varnish” and after applying 4 coats was happy it with how little it yellowed. To be honest it could have used a few more coats but I was so sick of varnishing that I decided I’d rather build a new patio table next year than do any more varnishing.</p>
<p><img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170610_180431.jpg" alt="The Finished Table">  </p>
<p><img src="https://s3-eu-west-1.amazonaws.com/stefano-lupo-blog-photos/patio-table/20170610_180521.jpg" alt="The Underside"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://stefanolupo.tech/blog/2017/09/02/hexagonPatioTable/" data-id="cj73tscie0000o0qj3hxt0vne" class="article-share-link">Share</a>
      
        <a href="http://stefanolupo.tech/blog/2017/09/02/hexagonPatioTable/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Woodworking-Octagonal-Patio-Table-DIY-Steve-Ramsey/">Woodworking Octagonal Patio Table DIY Steve Ramsey</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Web-Programming/">Web Programming</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Woodworking/">Woodworking</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2017/10/17/GameOfLife/">John Conway&#39;s Game of Life in Processing</a>
          </li>
        
          <li>
            <a href="/blog/2017/09/19/Airport-Web-Sockets/">WebSocket Chat Room</a>
          </li>
        
          <li>
            <a href="/blog/2017/09/02/hexagonPatioTable/">Octagonal Patio Table</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Stefano Lupo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="http://stefanolupo.tech" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'stefanolupo-tech';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/blog/js/script.js"></script>

  </div>
</body>
</html>